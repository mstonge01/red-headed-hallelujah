<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red-Headed Hallelujah</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter (sans-serif) and Staatliches (blocky, for title) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Staatliches&display=swap" rel="stylesheet">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json?v=3">
    <meta name="theme-color" content="#EF4444">
    
    <style>
        /* Custom styles to match the album art aesthetic */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Using 'Staatliches' for the main album title to mimic the cover font */
        .font-album-title {
            font-family: 'Staatliches', cursive;
        }

        /* Custom scrollbar for playlists */
        #playlist::-webkit-scrollbar,
        #video-playlist::-webkit-scrollbar,
        #flipper-back::-webkit-scrollbar {
            width: 8px;
        }
        #playlist::-webkit-scrollbar-track,
        #video-playlist::-webkit-scrollbar-track,
        #flipper-back::-webkit-scrollbar-track {
            background: #374151; /* gray-700 */
            border-radius: 10px;
        }
        #playlist::-webkit-scrollbar-thumb,
        #video-playlist::-webkit-scrollbar-thumb,
        #flipper-back::-webkit-scrollbar-thumb {
            background: #EF4444; /* red-500 */
            border-radius: 10px;
        }
        #playlist::-webkit-scrollbar-thumb:hover,
        #video-playlist::-webkit-scrollbar-thumb:hover,
        #flipper-back::-webkit-scrollbar-thumb:hover {
            background: #DC2626; /* red-600 */
        }

        /* Style for the currently active playlist item */
        .playlist-item.active {
            background-color: #EF4444; /* red-500 */
            color: #FFFFFF; /* white */
        }

        /* Custom style for the progress bar slider thumb */
        #progress-bar-container input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #EF4444; /* red-500 */
            border-radius: 3px;
            cursor: pointer;
            margin-top: -6px; /* Center the thumb on the track */
        }
        
        #progress-bar-container input[type=range]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #EF4444; /* red-500 */
            border-radius: 3px;
            cursor: pointer;
        }

        /* Custom style for the progress bar track */
        #progress-bar-container input[type=range] {
             -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: #4B5563; /* gray-600 */
            outline: none;
        }

        /* Class for the player texture */
        .player-texture {
            background-color: #1F2937; /* This is Tailwind's bg-gray-800 */
            background-image: url('https://www.transparenttextures.com/patterns/stucco.png');
        }
        
        /* 'Live Glow' Pulse Animation */
        @keyframes pulseGlow {
            0%, 100% {
                box-shadow: 0 0 10px rgba(239, 68, 68, 0.4), 0 0 12px rgba(239, 68, 68, 0.3);
            }
            50% {
                box-shadow: 0 0 16px rgba(239, 68, 68, 0.7), 0 0 20px rgba(239, 68, 68, 0.5);
            }
        }
        
        .is-playing-glow {
            animation: pulseGlow 2.5s infinite ease-in-out;
        }

        /* --- Flipper Styles --- */
        .flipper-container {
            perspective: 1000px;
            padding-top: 100%; /* Creates a 1:1 aspect ratio */
        }
        #flipper {
            transform-style: preserve-3d;
            transition: transform 0.8s;
        }
        #flipper.is-flipped {
            transform: rotateY(180deg);
        }
        .flipper-front,
        .flipper-back {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        #flipper-back {
            transform: rotateY(180deg);
            background-color: #4B5563; /* gray-600 */
            background-image: url('https://www.transparenttextures.com/patterns/concrete-wall.png');
        }
        
        /* --- Song Art Crossfade --- */
        #song-art {
            transition: opacity 0.5s ease-in-out;
            opacity: 0;
        }
        #song-art.is-visible {
            opacity: 1;
        }

        /* --- Splash Screen Styles --- */
        #enter-btn {
            background: rgba(239, 68, 68, 0.8); /* red-500 with 80% opacity */
            border: 2px solid rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }
        #enter-btn:hover {
            background: rgba(220, 38, 38, 1); /* red-600 */
            border-color: white;
            transform: scale(1.05);
        }
        #enter-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        #update-status {
            background: rgba(17, 24, 39, 0.8); /* gray-900 with 80% opacity */
        }

        /* --- Skip Intro Button Style --- */
        #skip-intro-btn {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        #skip-intro-btn:hover {
            background: rgba(0, 0, 0, 0.75);
            border-color: rgba(255, 255, 255, 0.7);
        }

        /* --- Karaoke/Lyrics Styles --- */
        #lyrics-container {
            font-family: 'Staatliches', cursive; /* Use album font for lyrics */
            font-size: 1.5rem; /* 24px */
            line-height: 2rem; /* 32px */
            letter-spacing: 0.05em;
            text-align: center;
        }

        .lyric-line {
            transition: all 0.3s ease-in-out;
            opacity: 0.4;
            padding: 4px 8px;
            border-radius: 4px;
            transform: scale(0.95);
        }

        .lyric-line.active-lyric {
            opacity: 1;
            color: #FBBF24; /* yellow-400 */
            background: rgba(17, 24, 39, 0.4); /* gray-900 with 40% opacity */
            transform: scale(1);
        }

    </style>
</head>
<body class="bg-gray-900 text-gray-300 min-h-screen flex items-center justify-center p-4">

    <!-- Video Splash Screen -->
    <div id="splash-screen" class="fixed top-0 left-0 w-full h-full bg-gray-900 z-50 flex items-center justify-center opacity-100 transition-opacity duration-1000">
        
        <!-- Video: NO Autoplay -->
        <video id="splash-video" class="max-w-full max-h-full object-contain" preload="auto" playsinline>
            <source src="paint-video.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        
        <!-- Status / Button Container -->
        <div class="absolute inset-0 flex items-center justify-center">
             <!-- "Checking for Updates..." - Only shown on PWA app load -->
            <div id="update-status" class="hidden p-4 rounded-lg text-white font-album-title text-xl tracking-wider">
                Checking for Updates...
            </div>

            <!-- "Click to Begin" Button - Hidden until check is done -->
            <button id="enter-btn" class="hidden z-60 text-white p-4 px-8 font-album-title text-xl tracking-wider rounded-lg" disabled>
                Click to Begin
            </button>
        </div>

        <!-- Skip Intro Button -->
        <button id="skip-intro-btn" class="hidden absolute bottom-5 left-1/2 -translate-x-1/2 z-60 text-white px-4 py-2 rounded-lg text-sm hover:bg-black/75 transition">
            Skip Intro
        </button>
    </div>

    <!-- Main Player Container (starts invisible) -->
    <div id="player-container" class="w-full max-w-4xl opacity-0 transition-opacity duration-1000">
        
        <!-- Player Container -->
        <div class="player-texture shadow-2xl overflow-hidden flex flex-col md:flex-row">
            
            <!-- Left Side: Album Artwork, Video, & Lyrics -->
            <div class="w-full md:w-1/2 flex-shrink-0 flex flex-col">
                <!-- Flipper container (1:1 aspect ratio) -->
                <div class="relative w-full flipper-container bg-black"> 
                    
                    <!-- Video Panel (Starts Hidden) -->
                    <div id="video-panel" class="absolute top-0 left-0 w-full h-full z-20 hidden">
                        <iframe id="video-iframe" class="w-full h-full" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                    </div>
                    
                    <!-- Artwork & Lyrics Flipper -->
                    <div id="flipper" class="absolute top-0 left-0 w-full h-full z-10">
                        <!-- FRONT (Album Art) -->
                        <div class="flipper-front absolute w-full h-full">
                            <!-- Main Album Art -->
                            <img src="cover.png" alt="Album Art for Red-Headed Hallelujah" class="w-full h-full object-cover">
                            <!-- Song-Specific Art (fades in) -->
                            <img id="song-art" src="" alt="Song-specific art" class="absolute top-0 left-0 w-full h-full object-cover">
                        </div>
                        <!-- BACK (Lyrics) -->
                        <div id="flipper-back" class="flipper-back absolute w-full h-full p-6 overflow-y-auto">
                            <!-- Lyrics will be injected here -->
                            <div id="lyrics-container" class="text-gray-200 space-y-2"></div>
                        </div>
                    </div>
                </div>

                <!-- Buttons: Lyrics & About -->
                <div class="flex">
                    <button id="lyrics-btn" class="flex-1 bg-red-500 text-white font-album-title tracking-wider text-lg p-3 hover:bg-red-600 transition-colors duration-200">
                        Lyrics
                    </button>
                    <button id="about-btn" class="flex-1 bg-gray-600 text-white font-album-title tracking-wider text-lg p-3 hover:bg-gray-700 transition-colors duration-200 border-l border-gray-800">
                        About This App
                    </button>
                </div>
            </div>

            <!-- Right Side: Info, Controls, Playlist -->
            <div class="w-full md:w-1/2 p-6 flex flex-col">
                
                <!-- Top-Right: Current Song Info -->
                <div class="mb-4 flex-shrink-0">
                    <p class="text-lg uppercase tracking-widest text-red-500 font-album-title">Now Playing</p>
                    <h2 id="song-title" class="text-3xl text-yellow-400 truncate font-album-title tracking-wider">Song Title</h2>
                    <h3 id="song-artist" class="text-lg text-gray-300">A mstonge01 Project</h3>
                </div>

                <!-- Middle-Right: Controls & Progress Bar -->
                <div class="mb-4 flex-shrink-0">
                    <!-- Progress Bar -->
                    <div id="progress-bar-container" class="mb-3">
                         <input type="range" id="progress-bar" class="w-full h-1 bg-gray-700 rounded-lg cursor-pointer" value="0" min="0" max="100">
                    </div>
                    <!-- Time Display -->
                    <div class="flex justify-between text-sm text-gray-400">
                        <span id="current-time">0:00</span>
                        <span id="duration-time">0:00</span>
                    </div>

                    <!-- Controls -->
                    <div class="flex justify-center items-center space-x-6 mt-4">
                        <!-- Previous Button -->
                        <button id="prev-btn" class="text-gray-400 hover:text-red-500 transition-colors duration-200">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M8.445 14.832A1 1 0 0010 14.03V5.969a1 1 0 00-1.555-.832L4.12 9.168a1 1 0 000 1.664l4.325 4zM10.879 9.168a1 1 0 000 1.664l4.325 4A1 1 0 0017 14.03V5.969a1 1 0 00-1.555-.832l-4.325 4z"/></svg>
                        </button>
                        <!-- Play/Pause Button -->
                        <button id="play-pause-btn" class="w-16 h-16 bg-red-500 text-white rounded-full flex items-center justify-center text-2xl hover:bg-red-600 transition-colors duration-200 shadow-lg">
                            <!-- Play Icon -->
                            <svg id="play-icon" class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8.002v3.996a1 1 0 001.555.832l3.197-1.998a1 1 0 000-1.664l-3.197-1.998z" clip-rule="evenodd"/></svg>
                            <!-- Pause Icon (hidden by default) -->
                            <svg id="pause-icon" class="w-8 h-8 hidden" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h1a1 1 0 001-1V8a1 1 0 00-1-1H8zm5 0a1 1 0 00-1 1v4a1 1 0 001 1h1a1 1 0 001-1V8a1 1 0 00-1-1h-1z" clip-rule="evenodd"/></svg>
                        </button>
                        <!-- Next Button -->
                        <button id="next-btn" class="text-gray-400 hover:text-red-500 transition-colors duration-200">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M4.555 5.168A1 1 0 003 5.969v8.062a1 1 0 001.555.832l4.325-4a1 1 0 000-1.664l-4.325-4zM10.879 5.168A1 1 0 009.324 5.97v8.062a1 1 0 001.555.832l4.325-4a1 1 0 000-1.664l-4.325-4z"/></svg>
                        </button>
                    </div>
                </div>
                
                <!-- Bottom-Right: Playlist Tabs & Container -->
                <div class="flex-grow flex flex-col min-h-0">
                    <!-- Tabs -->
                    <div class="flex-shrink-0 flex">
                        <button id="audio-tab" class="flex-1 p-3 font-album-title tracking-wider text-lg transition-colors duration-200 border-b-2 bg-gray-700/50 border-red-500 text-white">Audio</button>
                        <button id="video-tab" class="flex-1 p-3 font-album-title tracking-wider text-lg transition-colors duration-200 border-b-2 bg-transparent border-gray-700 text-gray-500 hover:bg-gray-800/50">Video</button>
                    </div>

                    <!-- Playlist Container -->
                    <div class="flex-grow relative min-h-0 h-80 md:h-auto">
                        <!-- Audio Playlist -->
                        <div id="playlist" class="absolute top-0 left-0 w-full h-full overflow-y-auto pr-2">
                            <!-- Playlist items will be injected here by JavaScript -->
                        </div>
                        <!-- Video Playlist (Hidden) -->
                        <div id="video-playlist" class="absolute top-0 left-0 w-full h-full overflow-y-auto pr-2 hidden">
                            <!-- Video items will be injected here by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- The actual audio element, hidden from view -->
    <audio id="audio-player"></audio>
    <audio id="intro-audio" src="hallelujah-intro.mp3" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 1. DATABASES ---
            const songs = [
                { 
                    title: "Intro", 
                    src: "01-intro.mp3",
                    image_src: "01-intro-art.png",
                    lyrics: [
                        { time: 26, text: "They say a light can't be contained..." },
                        { time: 33, text: "And a fire can't be tamed." },
                        { time: 40, text: "Well, this one's got red hair." },
                        { time: 44, text: "Let's start the story there..." }
                    ]
                },
                { 
                    title: "The Crimson Tide", 
                    src: "02-the-crimson-tide.mp3",
                    image_src: "02-the-crimson-tide-art.png",
                    lyrics: [
                        { time: 10, text: "The waves they roared the night was black" },
                        { time: 12, text: "A lantern swung on the captain’s rack" },
                        { time: 15, text: "But there she swam with hair of flame" },
                        { time: 17, text: "And called me out by my own name" },
                        { time: 20, text: "Oh the crimson tide it pulled me near" },
                        { time: 22, text: "Her voice like gold her smile so clear" },
                        { time: 25, text: "A red-haired mermaid stole my heart" },
                        { time: 27, text: "And dragged me down to where dreams start" },
                        { time: 35, text: "Her eyes were green like kelp at dawn" },
                        { time: 37, text: "Her laughter rang like a siren’s song" },
                        { time: 40, text: "I reached my hand she held it tight" },
                        { time: 42, text: "And pulled me deep into the night" },
                        { time: 45, text: "What’s a man to do at sea" },
                        { time: 47, text: "When a mermaid sets his spirit free" },
                        { time: 50, text: "Oh the crimson tide it pulled me near" },
                        { time: 52, text: "Her voice like gold her smile so clear" },
                        { time: 55, text: "A red-haired mermaid stole my heart" },
                        { time: 57, text: "And dragged me down to where dreams start" },
                        { time: 75, text: "The ocean’s depths they hold no fear" },
                        { time: 77, text: "Not when her whispers fill my ear" },
                        { time: 80, text: "No compass now no stars no map" },
                        { time: 82, text: "Just her soft kiss and the waves that clap" }
                    ]
                },
                { 
                    title: "Real Women", 
                    src: "03-real-women.mp3",
                    image_src: "03-real-women-art.png",
                    lyrics: [
                        { time: 10, text: "Another Tuesday morning, same old routine" },
                        { time: 14, text: "The vanity mirror, a shallow scene" },
                        { time: 18, text: "They're trading secrets, whispers in the hall" },
                        { time: 22, text: "\"Did you see what she was wearing? It's just awful, y'all\"" },
                        { time: 26, text: "Pink manicures and little white lies" },
                        { time: 30, text: "They spend their whole damn paycheck on what money buys" },
                        { time: 34, text: "Little bows and kitten heels, scared to break a sweat" },
                        { time: 38, text: "Oh, they call it living, but they haven't learned to live yet" },
                        { time: 42, text: "'Cause real women drive Jeeps, baby, roof top down" },
                        { time: 46, text: "Tearing up the blacktop, all over this town" },
                        { time: 50, text: "Got the sun in our faces, dust in our hair" },
                        { time: 54, text: "Don't need a paved road 'cause we don't really care" },
                        { time: 58, text: "Spinning the tires on a path of our own" },
                        { time: 62, text: "Got the radio blasting, driving hard to the bone" },
                        { time: 66, text: "Yeah, real women drive Jeeps, can you hear that sound?" },
                        { time: 70, text: "The only gossip we're spreading is the bass that shakes the ground!" },
                        { time: 82, text: "They’re filtering pictures 'til their skin is pristine" },
                        { time: 86, text: "Afraid of a smudge, afraid of what's real and mean" },
                        { time: 90, text: "Obsessed with the weight on that digital scale" },
                        { time: 94, text: "Their biggest problem is a broken fingernail" },
                        { time: 98, text: "They spend all their hours just trying to fit the mold" },
                        { time: 102, text: "Another copy of a story that's already told" },
                        { time: 106, text: "Hiding from the weather, shielding their complexion" },
                        { time: 110, text: "Just a fragile little doll craving cheap affection" },
                        { time: 114, text: "'Cause real women drive Jeeps, baby, roof top down" },
                        { time: 118, text: "Tearing up the blacktop, all over this town" },
                        { time: 122, text: "Got the sun in our faces, dust in our hair" },
                        { time: 126, text: "Don't need a paved road 'cause we don't really care" },
                        { time: 130, text: "Spinning the tires on a path of our own" },
                        { time: 134, text: "Got the radio blasting, driving hard to the bone" }
                    ]
                },
                { 
                    title: "Red-Headed Hallelujah", 
                    src: "04-red-headed-hallelujah.mp3",
                    image_src: "04-red-headed-hallelujah-art.png",
                    lyrics: [
                        { time: 15, text: "The boss man’s yelling" },
                        { time: 16, text: "My desk’s a mess" },
                        { time: 17, text: "Deadlines circling" },
                        { time: 19, text: "I confess" },
                        { time: 20, text: "The coffee’s cold" },
                        { time: 21, text: "My patience thin" },
                        { time: 23, text: "This nine-to-five feels like a sin" },
                        { time: 26, text: "But then I see her" },
                        { time: 27, text: "That red-headed light" },
                        { time: 29, text: "Her smile burns through my darkest night" },
                        { time: 31, text: "Oh hallelujah" },
                        { time: 34, text: "I’m gonna be alright" },
                        { time: 36, text: "Oh hallelujah" },
                        { time: 39, text: "I’m gonna be alright" },
                        { time: 54, text: "Two boys screaming" },
                        { time: 56, text: "The house is wild" },
                        { time: 58, text: "Spilled milk rivers" },
                        { time: 59, text: "And tantrum trials" },
                        { time: 60, text: "I’m just one man" },
                        { time: 62, text: "I feel so small" },
                        { time: 63, text: "How do I answer their every call" },
                        { time: 65, text: "But then I see her" },
                        { time: 67, text: "That red-headed light" },
                        { time: 68, text: "Her smile burns through my darkest night" },
                        { time: 71, text: "Oh hallelujah" },
                        { time: 73, text: "I’m gonna be alright" },
                        { time: 75, text: "Oh hallelujah" },
                        { time: 78, text: "I’m gonna be alright" },
                        { time: 95, text: "Breath is short" },
                        { time: 96, text: "My chest is tight" },
                        { time: 98, text: "The walls are closing" }
                    ]
                },
                { 
                    title: "The Good Stuff", 
                    src: "05-the_good_stuff.mp3",
                    image_src: "05-the_good_stuff-art.png",
                    lyrics: [
                        { time: 13, text: "My best friend had an art class," },
                        { time: 14, text: "I think it was 101" },
                        { time: 16, text: "They talked about Picasso, and what to do for fun" },
                        { time: 19, text: "He sat beside a girl he knew," },
                        { time: 21, text: "they chatted 'bout the week" },
                        { time: 22, text: "And somehow they got on the topic of the \"forbidden mystique.\"" },
                        { time: 26, text: "She said she'd always wondered," },
                        { time: 27, text: "but never took the chance" },
                        { time: 29, text: "My buddy said," },
                        { time: 30, text: "\"I know a guy, let's circumstance!”" },
                        { time: 32, text: "He calls me up on my flip phone," },
                        { time: 34, text: "says \"Man, I need a favor\"" },
                        { time: 36, text: "\"My friend wants the experience," },
                        { time: 37, text: "can you supply the flavor?\"" },
                        { time: 39, text: "He said \"You know the good stuff, you've got the master plan\"" },
                        { time: 42, text: "I said \"Yeah, I'm your guy, I'll do what I can.\"" },
                        { time: 45, text: "Just another Tuesday, a simple, youthful quest" },
                        { time: 48, text: "I had no idea it was a cosmic test." },
                        { time: 51, text: "We met up on a Saturday," },
                        { time: 53, text: "as I remember well" },
                        { time: 54, text: "And that's the day I saw your face," },
                        { time: 56, text: "and stumbled where I fell" },
                        { time: 58, text: "You had that long red hair, and freckles, and a choker on your neck" },
                        { time: 61, text: "My brain just went offline," },
                        { time: 63, text: "I was a total wreck." },
                        { time: 64, text: "The mission was a failure," },
                        { time: 66, text: "a total, epic bust" },
                        { time: 68, text: "But I didn't even notice," },
                        { time: 70, text: "I'd found my sacred trust" },
                        { time: 71, text: "Who needs the \"good stuff\" when I'm looking at you?" },
                        { time: 74, text: "My whole world changed that afternoon." },
                        { time: 119, text: "It's funny how a stupid plan," },
                        { time: 121, text: "a half-baked high school plot" },
                        { time: 123, text: "Could be the single greatest stroke of luck" },
                        { time: 125, text: "I ever got." },
                        { time: 126, text: "We were just kids trying to find a little buzz" },
                        { time: 129, text: "But I found my \"forever\" right there," },
                        { time: 130, text: "just because." },
                        { time: 132, text: "I saw the future, I saw the white hairs and the wrinkled hands" },
                        { time: 135, text: "I saw the family we would build on these suburban lands." },
                        { time: 139, text: "We met up on a Saturday," },
                        { time: 140, text: "as I remember well" },
                        { time: 142, text: "And that's the day I saw your face," },
                        { time: 144, text: "and stumbled where I fell" },
                        { time: 146, text: "You had that long red hair, and freckles, and a choker on your neck" },
                        { time: 149, text: "My brain just went offline," },
                        { time: 151, text: "I was a total wreck." },
                        { time: 152, text: "The mission was a failure," },
                        { time: 154, text: "a total, epic bust" },
                        { time: 156, text: "But I didn't even notice," },
                        { time: 157, text: "I'd found my sacred trust" }
                    ]
                },
                { 
                    title: "Zero Degree Beach", 
                    src: "06-zero-degree-beach.mp3",
                    image_src: "06-zero-degree-beach-art.png",
                    lyrics: [
                        { time: 0, text: "I check the thermostat, read the outside air" },
                        { time: 3, text: "It says \"Don't go out there without a proper pair\"" },
                        { time: 6, text: "I'm zippin' up my jacket, puttin' gloves on my hand" },
                        { time: 9, text: "Preparing for the freeze that grips this northern land" },
                        { time: 13, text: "But I hear the click-clack coming down the hall" },
                        { time: 16, text: "Like she's stepping off the sand right past the garden wall" },
                        { time: 20, text: "I don't even ask her, I already know" },
                        { time: 23, text: "She's got a secret summer in the middle of the snow" },
                        { time: 26, text: "She says, \"I need my freedom, need to feel the floor\"" },
                        { time: 30, text: "Then she grabs her heavy coat and heads right for the door..." },
                        { time: 33, text: "She's walking on the Zero-Degree Beach!" },
                        { time: 37, text: "The comfort of that plastic, nothing else can reach" },
                        { time: 40, text: "She's walking on the Zero-Degree Beach!" },
                        { time: 44, text: "A beautiful stubborn habit that the cold can't teach" },
                        { time: 47, text: "No matter if it's autumn or a January sleet" },
                        { time: 50, text: "She's got the only summer that exists beneath her feet" },
                        { time: 54, text: "My quirky queen in her flip-flops, all year long!" },
                        { time: 60, text: "We went to a wedding, the venue was so grand" },
                        { time: 64, text: "White gloves and polished shoes across the marble land" },
                        { time: 67, text: "She looked like a million bucks, every hair was in place" },
                        { time: 70, text: "Except for that tell-tale sign of her personal space" },
                        { time: 74, text: "When she kicked off the heels just an hour after the dance" },
                        { time: 77, text: "And swapped in the cheap sandals with an affectionate glance" },
                        { time: 81, text: "Said, \"These are the true me, this is how I thrive\"" },
                        { time: 84, text: "The only person keeping California alive!" },
                        { time: 88, text: "Other people stare, they give a little look" },
                        { time: 91, text: "But they don't know the comfort that she's found inside that hook" },
                        { time: 95, text: "They don't know the story, the dedication, the peace" },
                        { time: 98, text: "She's got her priorities, and they're never gonna cease..." },
                        { time: 101, text: "She's walking on the Zero-Degree Beach!" },
                        { time: 105, text: "The comfort of that plastic, nothing else can reach" },
                        { time: 108, text: "She's walking on the Zero-Degree Beach!" },
                        { time: 112, text: "A beautiful stubborn habit that the cold can't teach" },
                        { time: 115, text: "No matter if it's autumn or a January sleet" },
                        { time: 118, text: "She's got the only summer that exists beneath her feet" },
                        { time: 122, text: "My quirky queen in her flip-flops, all year long!" },
                        { time: 129, text: "It's just a little thing..." }
                    ]
                },
                { 
                    title: "Caps", 
                    src: "07-caps.mp3",
                    image_src: "07-caps-art.png",
                    lyrics: [
                        { time: 15, text: "Well, the world has wonders, seven they say" },
                        { time: 17, text: "But they haven't seen your legs today" },
                        { time: 19, text: "They go on for miles, like a highway line" },
                        { time: 22, text: "So smooth and silky, Lord, they're fine" },
                        { time: 24, text: "From your pretty little ankles to your upper thighs" },
                        { time: 27, text: "They're the sweetest sight for these old eyes" },
                        { time: 30, text: "Yeah, they're long and lovely, sleek and strong" },
                        { time: 32, text: "I could stare at them all day long" },
                        { time: 34, text: "But oh, your tiny knee caps" },
                        { time: 37, text: "They're like little bottle caps" },
                        { time: 39, text: "Just sittin' there so neat and small" },
                        { time: 42, text: "They're the cutest part of all" },
                        { time: 44, text: "Yeah, your tiny knee caps" },
                        { time: 47, text: "Maybe they're my favorite maps" },
                        { time: 49, text: "Leading me to paradise" },
                        { time: 52, text: "Oh, those knees are mighty nice" },
                        { time: 60, text: "When you wear those cut-offs, frayed at the end" },
                        { time: 63, text: "That's when my poor heart just can't pretend" },
                        { time: 65, text: "It's a masterpiece of biology" },
                        { time: 68, text: "What those lovely legs just do to me" },
                        { time: 70, text: "Some men like mountains, some like the sea" },
                        { time: 73, text: "But your perfect stems are the view for me" },
                        { time: 75, text: "So graceful when you walk, so fine when you stand" },
                        { time: 78, text: "The best pair of legs in all the land" },
                        { time: 80, text: "But oh, your tiny knee caps" },
                        { time: 82, text: "They're like little bottle caps" },
                        { time: 85, text: "Just sittin' there so neat and small" },
                        { time: 87, text: "They're the cutest part of all" },
                        { time: 90, text: "Yeah, your tiny knee caps" },
                        { time: 92, text: "Maybe they're my favorite maps" },
                        { time: 95, text: "Leading me to paradise" },
                        { time: 97, text: "Oh, those knees are mighty nice" },
                        { time: 105, text: "Now, people write poems about your eyes" },
                        { time: 108, text: "And your lovely hair, to my surprise" },
                        { time: 110, text: "They can have your smile, they can have your hands" },
                        { time: 113, text: "But only I truly understand..." },
                        { time: 116, text: "The real attraction..." },
                        { time: 118, text: "The main event..." }
                    ]
                },
                { 
                    title: "Red Paddle Queen", 
                    src: "08-red-paddle-queen.mp3",
                    image_src: "08-red-paddle-queen.png",
                    lyrics: [
                        { time: 14, text: "Yeah, sun's high, water clear, reflections on the glass" },
                        { time: 16, text: "I'm chilling on the shore, letting summer days pass" },
                        { time: 19, text: "Then the scene shifts, the vibe lifts, as you come into view" },
                        { time: 22, text: "A vision on the water, everything brand new" },
                        { time: 24, text: "This ain't no mud bog ride, no four-wheel-drive sound" },
                        { time: 27, text: "Just a simple board beneath you, gliding without a sound" },
                        { time: 29, text: "But the grace in your motion, the way you ride the breeze" },
                        { time: 32, text: "Got me pausing my whole world, sinkin' to my knees (metaphorically)" },
                        { time: 35, text: "The paved roads disappear, the streetlights outta sight" },
                        { time: 38, text: "Just the shimmer of the lake, bathed in golden light" },
                        { time: 40, text: "I've seen the glitz and glamour, heard the big-city beat" },
                        { time: 43, text: "But the silent elegance you hold, man, that just can't be beat." },
                        { time: 46, text: "Oh, the Red Paddle Queen, setting fire to the tide" },
                        { time: 49, text: "That scarlet wave of hair, where the sunlight loves to hide" },
                        { time: 52, text: "You glide where the currents flow, you own the liquid street" },
                        { time: 54, text: "With every stroke, every move, you can't be beat (Nope)" },
                        { time: 57, text: "On the board, in the breeze, you're the only sight I need" },
                        { time: 60, text: "The Red Paddle Queen, a natural beauty, indeed." },
                        { time: 63, text: "From this distance, I can tell, you're commanding your space" },
                        { time: 66, text: "Got that country focus, that clear look on your face" },
                        { time: 78, text: "I admire the balance, the control, the silent power" },
                        { time: 80, text: "Like you're walking on the surface, in your own specific hour" },
                        { time: 83, text: "The paved roads disappear, the streetlights outta sight" },
                        { time: 86, text: "Just the shimmer of the lake, bathed in golden light" },
                        { time: 89, text: "I've seen the glitz and glamour, heard the big-city beat" },
                        { time: 92, text: "But the silent elegance you hold, man, that just can't be beat." },
                        { time: 95, text: "Oh, the Red Paddle Queen, setting fire to the tide" },
                        { time: 98, text: "That scarlet wave of hair, where the sunlight loves to hide" },
                        { time: 100, text: "You glide where the currents flow, you own the liquid street" },
                        { time: 103, text: "With every stroke, every move, you can't be beat (Nope)" },
                        { time: 106, text: "On the board, in the breeze, you're the only sight I need" },
                        { time: 109, text: "The Red Paddle Queen, a natural beauty, indeed." },
                        { time: 115, text: "Yeah, the perfect hue, on a canvas of blue" },
                        { time: 118, text: "You make the simple act look like something brand new" },
                        { time: 121, text: "It’s more than just a paddle, more than just the ride" },
                        { time: 123, text: "It's the confidence you carry, with nothing left to hide" },
                        { time: 131, text: "Oh, the Red Paddle Queen, setting fire to the tide" },
                        { time: 134, text: "That scarlet wave of hair, where the sunlight loves to hide" },
                        { time: 137, text: "You glide where the currents flow, you own the liquid street" },
                        { time: 139, text: "With every stroke, every move, you can't be beat (Nope)" }
                    ]
                },
                { 
                    title: "Interrupted", 
                    src: "09-interrupted.mp3",
                    image_src: "09-interrupted-art.png",
                    lyrics: [
                        { time: 12, text: "Well, the kids are down, the house is finally still" },
                        { time: 15, text: "I look at my sweet woman, man, she gives me that thrill" },
                        { time: 18, text: "She's got that look in her eye, I know what it's about" },
                        { time: 21, text: "I go and flip the deadbolt, try to shut the whole world out" },
                        { time: 24, text: "I take one step, she's pullin' me in close..." },
                        { time: 27, text: "The dog starts barkin' like he's seen a ghost!" },
                        { time: 33, text: "He's gotta go outside, man, what's a guy to do?" },
                        { time: 37, text: "By the time I'm back, she's checkin' work on her phone. Busted." },
                        { time: 39, text: "Interrupted! (Yeah!)" },
                        { time: 42, text: "Every single time!" },
                        { time: 45, text: "Gettin' interrupted! (Oh!)" },
                        { time: 48, text: "It oughta be a crime!" },
                        { time: 51, text: "Just tryin' to get some quiet time, just tryin' to connect" },
                        { time: 54, text: "But this whole damn house is showin' zero respect!" },
                        { time: 57, text: "Alright, take two, we're back behind the door" },
                        { time: 60, text: "She's got that fiery spark, leaves me wantin' more" },
                        { time: 63, text: "I put a record on, somethin' slow and deep" },
                        { time: 66, text: "Lean in for the kiss, she's the only one I want to keep..." },
                        { time: 69, text: "(\"Daaaaad?! I'm thirsty!\") A little voice! (Are you kiddin' me?!)" },
                        { time: 73, text: "He had a nightmare! (Of course he did!)" },
                        { time: 75, text: "He needs a band-aid! (For what?!)" },
                        { time: 77, text: "Interrupted! (Come on!)" },
                        { time: 83, text: "Every single time! Gettin' interrupted! (Woo!)" },
                        { time: 89, text: "It oughta be a crime!" },
                        { time: 92, text: "Just tryin' to get some quiet time, just tryin' to connect" },
                        { time: 95, text: "But this whole damn house is showin' zero respect!" },
                        { time: 98, text: "I tried the afternoon... (Mailman rang the bell!)" },
                        { time: 101, text: "I tried the early morn'... (Alarm clock went to hell!)" },
                        { time: 104, text: "Seems like the universe... (Is ringin' a warning bell!)" },
                        { time: 107, text: "That we're just too old for this... aw, what the hell." },
                        { time: 113, text: "I've had enough! I'm takin' back the night!" },
                        { time: 116, text: "I'm callin' up the sitter, gonna do this right!" },
                        { time: 125, text: "Got my good shirt on, she's lookin' like a queen" },
                        { time: 128, text: "That red-haired woman from my high school dreams" },
                        { time: 131, text: "We're out on the town, yeah, we're on a proper date" },
                        { time: 134, text: "We ain't comin' home until it's way too late" },
                        { time: 137, text: "The kids are at the sitter's, packed up for the night" },
                        { time: 140, text: "For the first time in a year, man, we're doin' this right" },
                        { time: 143, text: "We get back home, the house is dark and ours" },
                        { time: 146, text: "No little footsteps, no monsters, no alarms!" },
                        { time: 150, text: "NOT Interrupted! (No!)" },
                        { time: 154, text: "The house is finally clear!" },
                        { time: 157, text: "NOT Interrupted! (Yeah!)" }
                    ]
                },
                { 
                    title: "Cinnamon Serenade", 
                    src: "10-cinnamon-serenade.mp3",
                    image_src: "10-cinnamon-serenade-art.png",
                    lyrics: [
                        { time: 15, text: "The cabin logs were settled in, the family fast asleep" },
                        { time: 20, text: "The fireplace was embers, a promise I couldn't keep" },
                        { time: 24, text: "I said \"Goodnight, my darling,\" and hit the flannel sheets" },
                        { time: 29, text: "You stayed out by the fire glow, sippin' somethin' sweet" },
                        { time: 33, text: "A bottle full of cinnamon, they call it Fireball" },
                        { time: 38, text: "You said \"It's just so easy,\" leanin' on the wall" },
                        { time: 43, text: "You didn't see the danger, the sugary disguise" },
                        { time: 47, text: "Just the dancing flames reflected in your eyes" },
                        { time: 52, text: "Oh, but 3 AM came callin', with a crash and then a moan" },
                        { time: 56, text: "You woke me from my slumber, clutching the plastic throne" },
                        { time: 61, text: "And I was your humble servant, in the pale moonlight" },
                        { time: 65, text: "Holding back your lovely hair with all my might" },
                        { time: 70, text: "It wasn't wine and roses, it wasn't graceful, no" },
                        { time: 75, text: "But you're my cinnamon queen, even watching the bourbon flow" },
                        { time: 91, text: "That devil in a bottle, it whispers candy lies" },
                        { time: 96, text: "A liquid Trojan horse, a burnin', sweet surprise" },
                        { time: 100, text: "Shot after shot went down, smooth as a velvet glove" },
                        { time: 105, text: "You lost all track of reason, lost all track of love (for sobriety)" },
                        { time: 109, text: "The silence of the forest, shattered by the sound" },
                        { time: 117, text: "Of all that cinnamon whisky, fightin' the wrong way 'round" },
                        { time: 124, text: "Oh, but 3 AM came callin', with a crash and then a moan" },
                        { time: 128, text: "You woke me from my slumber, clutching the plastic throne" },
                        { time: 132, text: "And I was your humble servant, in the pale moonlight" },
                        { time: 137, text: "Holding back your lovely hair with all my might" },
                        { time: 142, text: "It wasn't wine and roses, it wasn't graceful, no" },
                        { time: 146, text: "But you're my cinnamon queen, even watching the bourbon flow" },
                        { time: 152, text: "Now, some guys get a siren, a goddess on a pedestal" },
                        { time: 156, text: "Mine was kneeling over, looking rather dreadful" },
                        { time: 160, text: "But as I held your forehead, and whispered \"it's alright\"" },
                        { time: 165, text: "My love was shining clearer than the stars on that cold night" },
                        { time: 170, text: "It’s not the perfect moments, it’s the ones we survive" },
                        { time: 174, text: "That prove you’re still the only one who makes me feel alive" },
                        { time: 193, text: "Oh, yeah, 3 AM came callin', with a crash and then a moan" },
                        { time: 197, text: "You woke me from my slumber, clutching the plastic throne" },
                        { time: 202, text: "And I was your humble servant, in the pale moonlight" }
                    ]
                },
                { 
                    title: "Basement Stereo Glow", 
                    src: "11-basement-stereo-glow.mp3",
                    image_src: "11-basement-stereo-glow.png",
                    lyrics: [
                        { time: 2, text: "The carpet's thin, the paneling is brown" },
                        { time: 5, text: "She’s got her stereo cranked up loud" },
                        { time: 7, text: "Her parents are out, they're at 'The Crown'" },
                        { time: 10, text: "So we can own this entire town" },
                        { time: 12, text: "She's got her bare feet sliding on the floor" },
                        { time: 15, text: "Right past the posters taped to her door" },
                        { time: 17, text: "The little green light on the CD player" },
                        { time: 20, text: "Is the only thing I'm focused on besides her." },
                        { time: 23, text: "She bounces on her heels, a little bit shy" },
                        { time: 26, text: "Then the fuzz guitar kicks in, and she closes her eyes" },
                        { time: 29, text: "One, two, three, four!" },
                        { time: 32, text: "She’s dancing to Sloan in the basement" },
                        { time: 35, text: "She knows all the words, every new arrangement" },
                        { time: 37, text: "She’s got her arms up, singing to the ceiling" },
                        { time: 40, text: "I’m just sitting on the couch, loving this feeling" },
                        { time: 43, text: "And she’s alright!" },
                        { time: 45, text: "(Ooo-ooo, she’s alright!)" },
                        { time: 48, text: "She’s alright!" },
                        { time: 50, text: "(Ooo-ooo!)" },
                        { time: 53, text: "She spins around and her red hair flies" },
                        { time: 56, text: "A perfect, blurry mess before my eyes" },
                        { time: 58, text: "She's got momentum and no decision" },
                        { time: 64, text: "She's closing her eyes, she's mouthing the parts" },
                        { time: 66, text: "Of all the songs she knows by heart" },
                        { time: 69, text: "She's jumping on the beat, then stops on a dime" },
                        { time: 72, text: "She's in her own world, and she's outside of time." },
                        { time: 75, text: "And I know, I know she's not afraid to" },
                        { time: 78, text: "Be who she wants, and break all the rules" },
                        { time: 81, text: "Here it comes now..." },
                        { time: 83, text: "She’s dancing to Weezer in the basement" },
                        { time: 86, text: "She’s playing air guitar for the replacement" },
                        { time: 89, text: "Of all the static on the radio" },
                        { time: 92, text: "I never, ever wanna go" },
                        { time: 94, text: "And she’s alright!" },
                        { time: 96, text: "(Ooo-ooo, she’s alright!)" },
                        { time: 99, text: "She’s alright!" },
                        { time: 102, text: "(Ooo-ooo!)" },
                        { time: 107, text: "The song breaks down, the music gets low" },
                        { time: 110, text: "She stops and looks at me, and I just know" },
                        { time: 112, text: "This is the only place I wanna be" },
                        { time: 115, text: "(The feedback's building, one, two, three...)" },
                        { time: 118, text: "She smiles a little, and the drums kick in" }
                    ]
                },
                { 
                    title: "Golden Devotion", 
                    src: "12-golden-devotion.mp3",
                    image_src: "12-golden-devotion-art.png",
                    lyrics: [
                        { time: 15, text: "Every ray" },
                        { time: 16, text: "A soft embrace" },
                        { time: 18, text: "Burning bright" },
                        { time: 20, text: "No hiding place" },
                        { time: 22, text: "Oh she worships the sun" },
                        { time: 28, text: "The summer kisses her fragile frame" },
                        { time: 31, text: "Each freckle whispers the sun's name" },
                        { time: 35, text: "The heat a lover's breath on her cheek" },
                        { time: 38, text: "In its light she’s bold not weak" },
                        { time: 42, text: "The cold can't hold her down" },
                        { time: 46, text: "She’s glowing like a crown" },
                        { time: 50, text: "Oh she worships the sun" },
                        { time: 54, text: "Feel the heat she’s undone" },
                        { time: 57, text: "Every ray" },
                        { time: 59, text: "A soft embrace" },
                        { time: 61, text: "Burning bright" },
                        { time: 63, text: "No hiding place" },
                        { time: 65, text: "Oh she worships the sun" }
                    ]
                },
                { 
                    title: "Natural Magic", 
                    src: "13-natural-magic.mp3",
                    image_src: "13-natural-magic-art.png",
                    lyrics: [
                        { time: 0, text: "Coffee's cold on the counter" },
                        { time: 2, text: "Fifty sets of boots by the door" },
                        { time: 5, text: "The TV's loud, camping stuff being scattered" },
                        { time: 8, text: "Like a Technicolor storm" },
                        { time: 11, text: "I'm just trying to find my keys" },
                        { time: 14, text: "You're in the center of the breeze" },
                        { time: 17, text: "Handling it all with such an ease" },
                        { time: 20, text: "And I'm just caught here in the view" },
                        { time: 23, text: "Watching all the things you do" },
                        { time: 25, text: "You're the calm inside the hurricane" },
                        { time: 28, text: "A whispered word that stops the rain" },
                        { time: 31, text: "It's an instinct I can't understand" },
                        { time: 34, text: "How you heal the world just with your hand" },
                        { time: 37, text: "It's a quiet strength, a guiding light" },
                        { time: 40, text: "Oh, the way you mother, making everything right." },
                        { time: 46, text: "A nose bleed and a sudden cry" },
                        { time: 48, text: "You're there before the tear can dry" },
                        { time: 51, text: "A quiet word, a healing kiss" },
                        { time: 54, text: "There's no problem you can't dismiss" },
                        { time: 57, text: "You're a judge, a nurse, a storyteller" },
                        { time: 60, text: "A fortress and a soft, warm pillow" },
                        { time: 63, text: "You see the world right through their eyes" },
                        { time: 66, text: "Without a hint of compromise" },
                        { time: 69, text: "And I'm just caught here in the view" },
                        { time: 71, text: "Watching all the things you do" },
                        { time: 74, text: "You're the calm inside the hurricane" },
                        { time: 77, text: "A whispered word that stops the rain" },
                        { time: 80, text: "It's an instinct I can't understand" },
                        { time: 83, text: "How you heal the world just with your hand" },
                        { time: 86, text: "It's a quiet strength, a guiding light" },
                        { time: 89, text: "Oh, the way you mother, making everything right." },
                        { time: 94, text: "I try my best, I play my part" },
                        { time: 97, text: "But you're the rhythm, you're the heart" },
                        { time: 100, text: "You don't just build a house, you build a home" },
                        { time: 103, text: "You plant the seeds and watch them grow" },
                        { time: 106, text: "With a patience I will never know" },
                        { time: 112, text: "You're the calmest place I've ever known" },
                        { time: 117, text: "And I'm just caught here in the view" },
                        { time: 120, text: "Watching all the things you do" }
                    ]
                },
                { 
                    title: "Outro", 
                    src: "14-outro.mp3",
                    image_src: "14-outro-art.png",
                    lyrics: [
                        { time: 27, text: "From the crimson tide to the cinnamon nights..." },
                        { time: 33, text: "The quirky and the true." },
                        { time: 39, text: "From the interrupted moments..." },
                        { time: 43, text: "To the magic you just do." },
                        { time: 51, text: "It’s the story of my life..." },
                        { time: 60, text: "My red-headed Hallelujah." }
                    ]
                },
                { 
                    title: "[Bonus Track] Red-Headed Hallelujah (Guitar Cover)", 
                    src: "15-red-headed-hallelujah-guitar.mp3",
                    image_src: "04-red-headed-hallelujah-art.png", // Uses Track 4 art
                    lyrics: []
                },
                { 
                    title: "[Bonus Track] Natural Magic (Acoustic)", 
                    src: "16-natural-magic-acoustic.mp3",
                    image_src: "13-natural-magic-art.png", // Uses Track 13 art (Natural Magic)
                    lyrics: []
                }
            ];

            const videos = [
                {
                    title: "Real Women",
                    src: "https://www.youtube.com/embed/VXiXI-mZvL4",
                    image_src: "03-real-women-art.png"
                },
                {
                    title: "Red-Headed Hallelujah",
                    src: "https://www.youtube.com/embed/0WVY004pOng",
                    image_src: "04-red-headed-hallelujah-art.png"
                },
                {
                    title: "Natural Magic",
                    src: "https://www.youtube.com/embed/usGSmvYKI5c",
                    image_src: "13-natural-magic-art.png" // Updated to match new track 13 art
                },
                {
                    title: "Natural Magic (Acoustic)",
                    src: "https://www.youtube.com/embed/YGCpLq5Bd6E",
                    image_src: "13-natural-magic-art.png" // Updated to match new track 13 art
                }
            ];

            const artistName = "A mstonge01 Project";
            const albumTitle = "Lyrics"; // Changed from "Liner Notes"
            const albumNote = ``; // Cleared as requested
            const aboutNote = ``; // Cleared as requested
            const albumName = "Red-Headed Hallelujah";

            // --- 2. DOM ELEMENT REFERENCES ---
            const splashScreen = document.getElementById('splash-screen');
            const splashVideo = document.getElementById('splash-video');
            const enterBtn = document.getElementById('enter-btn');
            const skipIntroBtn = document.getElementById('skip-intro-btn');
            const updateStatusEl = document.getElementById('update-status'); 
            const playerContainer = document.getElementById('player-container');
            const audioPlayer = document.getElementById('audio-player');
            const introAudio = document.getElementById('intro-audio');
            const songTitleEl = document.getElementById('song-title');
            const songArtistEl = document.getElementById('song-artist');
            
            const playlistEl = document.getElementById('playlist');
            const videoPlaylistEl = document.getElementById('video-playlist');
            const audioTab = document.getElementById('audio-tab');
            const videoTab = document.getElementById('video-tab');
            
            const playPauseBtn = document.getElementById('play-pause-btn');
            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const progressBar = document.getElementById('progress-bar');
            const currentTimeEl = document.getElementById('current-time');
            const durationTimeEl = document.getElementById('duration-time');
            
            const lyricsBtn = document.getElementById('lyrics-btn'); // Renamed from linerNotesBtn
            const aboutBtn = document.getElementById('about-btn');
            const flipper = document.getElementById('flipper');
            const lyricsContainerEl = document.getElementById('lyrics-container'); // Replaces noteBodyEl
            const songArtEl = document.getElementById('song-art');
            const mainPlayerDiv = document.querySelector('.player-texture');

            const videoPanel = document.getElementById('video-panel');
            const videoIframe = document.getElementById('video-iframe');
            

            // --- 3. PLAYER STATE ---
            let currentSongIndex = 0;
            let isPlaying = false;
            let hasUserInteracted = false;
            let currentView = 'lyrics'; // 'lyrics' or 'about'
            let currentLyricIndex = -1; // For tracking karaoke highlighting

            // --- 4. FUNCTIONS ---
            
            function showBeginButton() {
                updateStatusEl.style.display = 'none';
                enterBtn.textContent = 'Click to Begin';
                enterBtn.style.display = 'block';
                enterBtn.disabled = false;
            }

            function startVideoTransition() {
                if(hasUserInteracted) return;
                hasUserInteracted = true;
                
                if (window.matchMedia('(display-mode: standalone)').matches && 'serviceWorker' in navigator && navigator.serviceWorker.controller) {
                    console.log('Sending cache-content message to SW');
                    navigator.serviceWorker.controller.postMessage({ action: 'cache-content' });
                }
                
                introAudio.load(); 
                enterBtn.style.display = 'none';
                skipIntroBtn.classList.remove('hidden'); 

                splashVideo.play().catch(error => {
                    console.warn("Video play failed even after click:", error);
                    transitionToPlayer(); 
                });
            }

            function skipIntro() {
                splashVideo.pause();
                introAudio.pause(); 
                skipIntroBtn.classList.add('hidden'); 
                transitionToPlayer(); 
            }

            function transitionToPlayer() {
                skipIntroBtn.classList.add('hidden'); 
                setTimeout(() => {
                    splashScreen.style.opacity = '0';
                    playerContainer.style.opacity = '1';
                    
                    setTimeout(() => {
                        splashScreen.style.display = 'none';
                    }, 1000); 
                    
                }, 1000); 
            }
            
            function showVideoPanel(show, src = "") {
                if (show) {
                    pauseSong(); 
                    videoIframe.src = src + "?autoplay=1&modestbranding=1&rel=0";
                    videoPanel.classList.remove('hidden');
                    flipper.classList.add('hidden'); 
                } else {
                    videoIframe.src = ""; 
                    videoPanel.classList.add('hidden');
                    flipper.classList.remove('hidden'); 
                }
            }
            
            function updatePositionState() {
                if ('mediaSession' in navigator && navigator.mediaSession.metadata) {
                    const { duration, currentTime } = audioPlayer;
                    if (duration && isFinite(duration)) {
                        navigator.mediaSession.setPositionState({
                            duration: duration,
                            playbackRate: audioPlayer.playbackRate,
                            position: currentTime
                        });
                    }
                }
            }
            
            function updateMediaSession(song) {
                if ('mediaSession' in navigator) {
                    if (song) {
                        navigator.mediaSession.metadata = new MediaMetadata({
                            title: song.title,
                            artist: artistName,
                            album: albumName,
                            artwork: [
                                { src: song.image_src, sizes: '512x512', type: 'image/png' }
                            ]
                        });
                        navigator.mediaSession.playbackState = "playing";
                    } else {
                        if (navigator.mediaSession.metadata) {
                             navigator.mediaSession.playbackState = "paused";
                        }
                    }
                    updatePositionState(); 
                }
            }
            
            // NEW/UPDATED: Populates the lyrics panel
            function updateLyricsContent() {
                lyricsContainerEl.innerHTML = ''; // Clear previous lyrics
                
                if (currentView === 'about') {
                    // We've cleared the aboutNote, but we can put placeholder text or the HTML
                    lyricsContainerEl.innerHTML = aboutNote; // This is now an empty string
                } else if (currentView === 'lyrics') {
                    const song = songs[currentSongIndex];
                    if (song.lyrics && song.lyrics.length > 0) {
                        song.lyrics.forEach(line => {
                            const lineEl = document.createElement('div');
                            lineEl.classList.add('lyric-line');
                            lineEl.textContent = line.text;
                            lineEl.dataset.time = line.time; // Store time for highlighting
                            lyricsContainerEl.appendChild(lineEl);
                        });
                    } else {
                        // Show a message if no lyrics are available
                        lyricsContainerEl.innerHTML = `<div class="lyric-line" style="opacity: 0.7;">No lyrics available for this track.</div>`;
                    }
                }
            }

            // NEW: Handles the karaoke-style highlighting
            function updateLyricHighlighting() {
                const currentTime = audioPlayer.currentTime;
                const song = songs[currentSongIndex];
                
                if (!song.lyrics || song.lyrics.length === 0) {
                    return; // No lyrics to highlight
                }

                let newLyricIndex = -1;

                // Find the last lyric line whose time is before or at the current time
                for (let i = song.lyrics.length - 1; i >= 0; i--) {
                    if (currentTime >= song.lyrics[i].time) {
                        newLyricIndex = i;
                        break;
                    }
                }

                if (newLyricIndex !== currentLyricIndex) {
                    currentLyricIndex = newLyricIndex;
                    const allLyricLines = document.querySelectorAll('#lyrics-container .lyric-line');
                    
                    allLyricLines.forEach((line, index) => {
                        if (index === currentLyricIndex) {
                            line.classList.add('active-lyric');
                            // Scroll the active line into view
                            line.scrollIntoView({
                                behavior: 'smooth',
                                block: 'center' // 'center' or 'nearest'
                            });
                        } else {
                            line.classList.remove('active-lyric');
                        }
                    });
                }
            }


            function loadSong(song) {
                songTitleEl.textContent = song.title;
                songArtistEl.textContent = artistName;
                audioPlayer.src = song.src;
                songArtEl.src = song.image_src; 
                songArtEl.classList.remove('is-visible'); 
                
                if (!videoPanel.classList.contains('hidden')) {
                    showVideoPanel(false);
                }
                
                flipper.classList.remove('is-flipped');
                currentView = 'lyrics'; // Default to lyrics view
                updateLyricsContent(); // Pre-load the lyrics
                currentLyricIndex = -1; // Reset lyric highlighting
                
                updateActivePlaylistItem();
            }

            function playSong() {
                if (!audioPlayer.src || audioPlayer.src.endsWith('index.html')) {
                    loadSong(songs[currentSongIndex]);
                }
                
                if (!videoPanel.classList.contains('hidden')) {
                    showVideoPanel(false);
                }

                isPlaying = true;
                audioPlayer.play();
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                songArtEl.classList.add('is-visible'); 
                mainPlayerDiv.classList.add('is-playing-glow'); 
                
                currentView = 'lyrics'; // Set view to lyrics
                updateLyricsContent(); // Update lyrics panel
                updateMediaSession(songs[currentSongIndex]);
            }

            function pauseSong() {
                isPlaying = false;
                audioPlayer.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                songArtEl.classList.remove('is-visible');
                mainPlayerDiv.classList.remove('is-playing-glow');
                
                updateMediaSession(null);
            }

            function prevSong() {
                currentSongIndex--;
                if (currentSongIndex < 0) currentSongIndex = songs.length - 1;
                loadSong(songs[currentSongIndex]);
                if (isPlaying) playSong();
            }

            function nextSong() {
                currentSongIndex++;
                if (currentSongIndex > songs.length - 1) currentSongIndex = 0;
                loadSong(songs[currentSongIndex]);
                if (isPlaying) playSong();
            }

            function updateProgress(e) {
                const { duration, currentTime } = e.srcElement;
                if (duration) {
                    const progressPercent = (currentTime / duration) * 100;
                    progressBar.value = progressPercent;
                    durationTimeEl.textContent = formatTime(duration);
                    currentTimeEl.textContent = formatTime(currentTime);
                    updatePositionState();
                    updateLyricHighlighting(); // Karaoke sync
                }
            }

            function formatTime(seconds) {
                if (isNaN(seconds)) return "0:00";
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }

            function setProgress() {
                const duration = audioPlayer.duration;
                if (duration) {
                     audioPlayer.currentTime = (progressBar.value / 100) * duration;
                     updatePositionState();
                     updateLyricHighlighting(); // Update karaoke on seek
                }
            }
            
            function updateActivePlaylistItem() {
                const items = document.querySelectorAll('#playlist .playlist-item');
                items.forEach((item, index) => {
                    if (index === currentSongIndex) {
                        item.classList.add('active');
                        item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    } else {
                        item.classList.remove('active');
                    }
                });
            }

            function createPlaylist() {
                songs.forEach((song, index) => {
                    const item = document.createElement('div');
                    item.classList.add('playlist-item', 'p-3', 'rounded-lg', 'cursor-pointer', 'hover:bg-gray-700', 'transition-colors', 'duration-200', 'flex', 'items-center', 'space-x-3');
                    item.innerHTML = `
                        <img src="${song.image_src}" alt="Art for ${song.title}" class="w-12 h-12 rounded object-cover flex-shrink-0">
                        <div class="min-w-0">
                            <p class="font-album-title tracking-wider truncate text-base">${song.title}</p>
                            <p class="text-sm text-gray-400 truncate">${artistName}</p>
                        </div>
                    `;
                    item.addEventListener('click', () => {
                        currentSongIndex = index;
                        loadSong(song);
                        playSong();
                    });
                    playlistEl.appendChild(item);
                });
            }

            function createVideoPlaylist() {
                videos.forEach((video, index) => {
                    const item = document.createElement('div');
                    item.classList.add('playlist-item', 'p-3', 'rounded-lg', 'cursor-pointer', 'hover:bg-gray-700', 'transition-colors', 'duration-200', 'flex', 'items-center', 'space-x-3');
                    item.innerHTML = `
                        <img src="${video.image_src}" alt="Art for ${video.title}" class="w-12 h-12 rounded object-cover flex-shrink-0">
                        <div class="min-w-0">
                            <p class="font-album-title tracking-wider truncate text-base">${video.title}</p>
                            <p class="text-sm text-gray-400 truncate">Music Video</p>
                        </div>
                    `;
                    item.addEventListener('click', () => {
                        showVideoPanel(true, video.src);
                    });
                    videoPlaylistEl.appendChild(item);
                });
            }

            // --- 5. EVENT LISTENERS ---
            
            enterBtn.addEventListener('click', startVideoTransition);
            skipIntroBtn.addEventListener('click', skipIntro);

            splashVideo.addEventListener('ended', () => {
                if(hasUserInteracted) {
                    introAudio.play().catch(e => {
                        console.warn("Intro audio failed to play:", e);
                        transitionToPlayer(); 
                    });
                }
            });
            
            introAudio.addEventListener('ended', () => {
                transitionToPlayer();
            });
            
            playPauseBtn.addEventListener('click', () => {
                if (isPlaying) pauseSong();
                else playSong();
            });
            prevBtn.addEventListener('click', prevSong);
            nextBtn.addEventListener('click', nextSong);
            
            // Combined timeupdate listener
            audioPlayer.addEventListener('timeupdate', () => {
                updateProgress({ srcElement: audioPlayer }); // Pass the event object manually
                updateLyricHighlighting();
            });

            audioPlayer.addEventListener('ended', nextSong);
            progressBar.addEventListener('input', setProgress);
            
            // UPDATED: Lyrics Button Handler
            lyricsBtn.addEventListener('click', () => {
                if (!videoPanel.classList.contains('hidden')) {
                    showVideoPanel(false);
                }
                
                if (currentView === 'about') {
                    currentView = 'lyrics';
                    updateLyricsContent();
                    flipper.classList.add('is-flipped'); // Stay flipped
                } 
                else {
                    if (!flipper.classList.contains('is-flipped')) {
                         currentView = 'lyrics';
                         updateLyricsContent(); // Make sure lyrics are populated before flip
                    }
                    flipper.classList.toggle('is-flipped');
                }
            });
            
            // UPDATED: About Button Handler
            aboutBtn.addEventListener('click', () => {
                if (!videoPanel.classList.contains('hidden')) {
                    showVideoPanel(false);
                }

                currentView = 'about';
                updateLyricsContent();
                flipper.classList.add('is-flipped'); // Force flip
            });
            
            // --- Tab Logic ---
            function showPlaylist(type) {
                if (type === 'audio') {
                    playlistEl.classList.remove('hidden');
                    videoPlaylistEl.classList.add('hidden');
                    audioTab.className = "flex-1 p-3 font-album-title tracking-wider text-lg transition-colors duration-200 border-b-2 bg-gray-700/50 border-red-500 text-white";
                    videoTab.className = "flex-1 p-3 font-album-title tracking-wider text-lg transition-colors duration-200 border-b-2 bg-transparent border-gray-700 text-gray-500 hover:bg-gray-800/50";
                } else {
                    playlistEl.classList.add('hidden');
                    videoPlaylistEl.classList.remove('hidden');
                    videoTab.className = "flex-1 p-3 font-album-title tracking-wider text-lg transition-colors duration-200 border-b-2 bg-gray-700/50 border-red-500 text-white";
                    audioTab.className = "flex-1 p-3 font-album-title tracking-wider text-lg transition-colors duration-200 border-b-2 bg-transparent border-gray-700 text-gray-500 hover:bg-gray-800/50";
                }
            }

            audioTab.addEventListener('click', () => showPlaylist('audio'));
            videoTab.addEventListener('click', () => showPlaylist('video'));
            
            // --- Media Session Action Handlers (for truck controls) ---
            if ('mediaSession' in navigator) {
                navigator.mediaSession.setActionHandler('play', playSong);
                navigator.mediaSession.setActionHandler('pause', pauseSong);
                navigator.mediaSession.setActionHandler('previoustrack', prevSong);
                navigator.mediaSession.setActionHandler('nexttrack', nextSong);
                navigator.mediaSession.setActionHandler('seekto', (details) => {
                    audioPlayer.currentTime = details.seekTime;
                    updatePositionState();
                    updateLyricHighlighting(); // Update karaoke on seek
                });
            }

            // --- 6. INITIALIZE PLAYER ---
            createPlaylist();
            createVideoPlaylist();
            loadSong(songs[currentSongIndex]); // Load first song
            currentView = 'lyrics'; // Set initial view state
            updateLyricsContent(); // Update the text
            flipper.classList.remove('is-flipped'); // Ensure it starts on the front
            
            
            // --- 7. PWA Service Worker Registration ---
            // Check if we're in "app" mode
            const isPwa = window.matchMedia('(display-mode: standalone)').matches;

            // --- ALWAYS SHOW BEGIN BUTTON ---
            // This ensures the app is usable even if SW registration hangs or fails.
            showBeginButton();

            if (isPwa && 'serviceWorker' in navigator) {
                // --- IT'S THE APP ---
                // We've already shown the button, so we just register in the background.
                
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful:', registration);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                        // Button is already visible, so just log the error.
                    });
            } else {
                // --- IT'S THE PC (or a normal browser tab) ---
                console.log('Not in PWA mode, skipping PWA features.');
                // Button is already visible.
            }
        });
    </script>
</body>
</html>
